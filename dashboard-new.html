<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blue Banded Bee - Job Dashboard</title>
  
  <!-- Supabase CDN (required for Web Components authentication) -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  
  <!-- Blue Banded Bee Web Components -->
  <script type="module" src="/js/index.js"></script>
  
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f7fa;
      min-height: 100vh;
    }

    .page-header {
      background: white;
      border-bottom: 1px solid #e5e7eb;
      padding: 24px 0;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .page-header .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .page-title {
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 0;
      font-size: 1.5rem;
      font-weight: 700;
      color: #1a1a1a;
    }

    .bee-icon {
      font-size: 1.8rem;
    }

    .page-nav {
      display: flex;
      gap: 24px;
      align-items: center;
    }

    .nav-link {
      color: #6b7280;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s ease;
    }

    .nav-link:hover,
    .nav-link.active {
      color: #3b82f6;
    }

    .user-menu {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #3b82f6;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 14px;
    }

    .main-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px;
    }

    .dashboard-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding: 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .dashboard-filters {
      display: flex;
      gap: 16px;
      align-items: center;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .filter-label {
      font-size: 12px;
      font-weight: 500;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .filter-select {
      padding: 8px 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 14px;
      background: white;
      color: #374151;
    }

    .filter-select:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .page-actions {
      display: flex;
      gap: 12px;
    }

    .status-indicator {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: #6b7280;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #22c55e;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .bb-btn {
      padding: 8px 16px;
      border-radius: 6px;
      border: none;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      text-decoration: none;
    }

    .bb-btn-primary {
      background: #3b82f6;
      color: white;
    }

    .bb-btn-primary:hover {
      background: #2563eb;
    }

    .bb-btn-secondary {
      background: #f3f4f6;
      color: #374151;
    }

    .bb-btn-secondary:hover {
      background: #e5e7eb;
    }

    /* Web Component Styling Integration */
    bb-job-dashboard {
      display: block;
      width: 100%;
    }

    bb-auth-login {
      display: block;
      width: 100%;
      max-width: 400px;
      margin: 40px auto;
    }

    /* Webflow Integration Notes Styles */
    .webflow-notes {
      background: #f0f9ff;
      border: 1px solid #0ea5e9;
      border-radius: 8px;
      padding: 16px;
      margin: 20px 0;
      font-size: 14px;
      color: #0c4a6e;
    }

    .webflow-notes h4 {
      margin: 0 0 8px 0;
      color: #0c4a6e;
    }

    .webflow-notes code {
      background: #e0f2fe;
      padding: 2px 4px;
      border-radius: 3px;
      font-family: 'Monaco', 'Consolas', monospace;
    }

    @media (max-width: 768px) {
      .page-header .container {
        padding: 0 16px;
      }

      .page-nav {
        display: none;
      }

      .main-content {
        padding: 16px;
      }

      .dashboard-actions {
        flex-direction: column;
        align-items: stretch;
        gap: 16px;
      }

      .dashboard-filters {
        justify-content: space-between;
      }

      .page-actions {
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <!-- Page Header -->
  <header class="page-header">
    <div class="container">
      <h1 class="page-title">
        <span class="bee-icon">üêù</span>
        Blue Banded Bee
      </h1>
      
      <nav class="page-nav">
        <a href="/dashboard" class="nav-link active">Dashboard</a>
        <a href="/jobs" class="nav-link">Jobs</a>
        <a href="/settings" class="nav-link">Settings</a>
        <a href="/help" class="nav-link">Help</a>
      </nav>

      <div class="user-menu">
        <div class="status-indicator">
          <span class="status-dot"></span>
          <span>Live</span>
        </div>
        <div class="user-avatar" id="userAvatar">?</div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Webflow Integration Demo Notes -->
    <div class="webflow-notes">
      <h4>üöÄ Webflow Integration Demo</h4>
      <p>This page demonstrates how to integrate Blue Banded Bee Web Components into a Webflow site:</p>
      <ul>
        <li><strong>Authentication:</strong> Uses <code>&lt;bb-auth-login&gt;</code> component</li>
        <li><strong>Dashboard:</strong> Uses <code>&lt;bb-job-dashboard&gt;</code> component with data binding</li>
        <li><strong>Events:</strong> Components emit events for Webflow interactions</li>
        <li><strong>Styling:</strong> Components include embedded styles for consistency</li>
      </ul>
    </div>

    <!-- Dashboard Controls -->
    <div class="dashboard-actions">
      <div class="dashboard-filters">
        <div class="filter-group">
          <label class="filter-label">Date Range</label>
          <select class="filter-select" id="dateRange">
            <option value="today">Today</option>
            <option value="last7" selected>Last 7 Days</option>
            <option value="last30">Last 30 Days</option>
            <option value="last90">Last 90 Days</option>
            <option value="all">All Time</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label class="filter-label">Refresh</label>
          <select class="filter-select" id="refreshInterval">
            <option value="0">Manual</option>
            <option value="10" selected>10 seconds</option>
            <option value="30">30 seconds</option>
            <option value="60">1 minute</option>
          </select>
        </div>
      </div>

      <div class="page-actions">
        <button class="bb-btn bb-btn-secondary" onclick="refreshDashboard()">
          <span>‚Üª</span> Refresh
        </button>
        <button class="bb-btn bb-btn-primary" onclick="showNewJobModal()">
          <span>+</span> New Job
        </button>
      </div>
    </div>

    <!-- Web Components Authentication Check -->
    <bb-auth-login id="authComponent" style="display: none;"></bb-auth-login>

    <!-- 
      Blue Banded Bee Job Dashboard Web Component
      This demonstrates the Webflow integration pattern:
      - Uses data-bind attributes for dynamic content
      - Self-contained with embedded styles 
      - Handles authentication internally
      - Emits events for external integration
    -->
    <bb-job-dashboard 
      id="jobDashboard"
      auto-load="true" 
      refresh-interval="10" 
      date-range="last7" 
      limit="10"
      show-charts="false"
      style="display: none;">
    </bb-job-dashboard>
  </main>

  <script>
    // Webflow Integration Demo Script
    // This demonstrates how to use Blue Banded Bee Web Components in a Webflow page
    
    let currentUser = null;
    let dashboardComponent = null;
    let authComponent = null;

    // Initialize page when DOM and Web Components are loaded
    document.addEventListener('DOMContentLoaded', async () => {
      console.log('Webflow Dashboard Demo initializing...');
      
      // Wait for Web Components to be available
      await waitForWebComponents();
      
      // Get component references
      dashboardComponent = document.getElementById('jobDashboard');
      authComponent = document.getElementById('authComponent');
      
      // Set up authentication listener
      setupAuthenticationListener();
      
      // Set up Web Component event listeners
      setupComponentEventListeners();
      
      // Set up filter controls
      setupFilterControls();
      
      // Initial authentication check
      await checkAuthenticationStatus();
    });

    // Wait for Blue Banded Bee Web Components to be available
    async function waitForWebComponents() {
      return new Promise((resolve) => {
        const checkComponents = () => {
          // Check if our Web Components are defined
          if (window.BBComponents && 
              customElements.get('bb-job-dashboard') && 
              customElements.get('bb-auth-login')) {
            console.log('Web Components loaded successfully');
            resolve();
          } else {
            setTimeout(checkComponents, 100);
          }
        };
        checkComponents();
      });
    }

    // Set up authentication state listener
    function setupAuthenticationListener() {
      if (window.BBComponents?.authManager) {
        window.BBComponents.authManager.onAuthStateChange((event, session) => {
          console.log('Auth state changed:', event, session?.user?.email);
          
          if (session && session.user) {
            handleUserAuthenticated(session.user);
          } else {
            handleUserUnauthenticated();
          }
        });
      }
    }

    // Set up Web Component event listeners
    function setupComponentEventListeners() {
      // Dashboard component events
      if (dashboardComponent) {
        dashboardComponent.addEventListener('dashboard-loaded', (e) => {
          console.log('Dashboard data loaded:', e.detail.data);
          showNotification('Dashboard updated', 'success');
        });
        
        dashboardComponent.addEventListener('dashboard-error', (e) => {
          console.error('Dashboard error:', e.detail.error);
          showNotification('Failed to load dashboard', 'error');
        });
        
        dashboardComponent.addEventListener('create-job-requested', () => {
          showNewJobModal();
        });
        
        dashboardComponent.addEventListener('job-details-requested', (e) => {
          showJobDetails(e.detail.jobId);
        });
      }
      
      // Authentication component events
      if (authComponent) {
        authComponent.addEventListener('login-success', (e) => {
          console.log('Login successful:', e.detail.user.email);
          showNotification(`Welcome, ${e.detail.user.email}!`, 'success');
        });
        
        authComponent.addEventListener('login-error', (e) => {
          console.error('Login error:', e.detail.error);
          showNotification('Login failed', 'error');
        });
      }
    }

    // Check current authentication status
    async function checkAuthenticationStatus() {
      if (window.BBComponents?.authManager) {
        const session = await window.BBComponents.authManager.getSession();
        if (session && session.user) {
          handleUserAuthenticated(session.user);
        } else {
          handleUserUnauthenticated();
        }
      }
    }

    // Handle authenticated user
    function handleUserAuthenticated(user) {
      currentUser = user;
      console.log('User authenticated:', user.email);
      
      // Update user avatar
      const avatar = document.getElementById('userAvatar');
      if (avatar && user.email) {
        avatar.textContent = user.email.charAt(0).toUpperCase();
        avatar.title = user.email;
      }
      
      // Show dashboard component, hide auth component
      if (authComponent) authComponent.style.display = 'none';
      if (dashboardComponent) {
        dashboardComponent.style.display = 'block';
        // Trigger dashboard reload if it's not auto-loading
        dashboardComponent.refresh();
      }
    }

    // Handle unauthenticated state
    function handleUserUnauthenticated() {
      currentUser = null;
      console.log('User not authenticated');
      
      // Reset user avatar
      const avatar = document.getElementById('userAvatar');
      if (avatar) {
        avatar.textContent = '?';
        avatar.title = '';
      }
      
      // Show auth component, hide dashboard
      if (authComponent) authComponent.style.display = 'block';
      if (dashboardComponent) dashboardComponent.style.display = 'none';
    }

    // Set up filter controls to interact with Web Component
    function setupFilterControls() {
      const dateRange = document.getElementById('dateRange');
      const refreshInterval = document.getElementById('refreshInterval');

      if (dateRange && dashboardComponent) {
        dateRange.addEventListener('change', () => {
          // Update Web Component attribute
          dashboardComponent.setAttribute('date-range', dateRange.value);
        });
      }

      if (refreshInterval && dashboardComponent) {
        refreshInterval.addEventListener('change', () => {
          // Update Web Component attribute
          dashboardComponent.setAttribute('refresh-interval', refreshInterval.value);
        });
      }
    }

    // Utility functions
    function refreshDashboard() {
      if (dashboardComponent && currentUser) {
        dashboardComponent.refresh();
      }
    }

    function showNewJobModal() {
      // In a real Webflow implementation, this would open a Webflow modal
      alert('New job creation modal would open here.\n\nIn Webflow, you would:\n1. Show a modal div\n2. Use bb-job-create component\n3. Handle job creation events');
    }

    function showJobDetails(jobId) {
      // In a real Webflow implementation, this would navigate to a job details page
      alert(`Job details page would open for job ID: ${jobId}\n\nIn Webflow, you would:\n1. Navigate to /job-details?id=${jobId}\n2. Use bb-job-details component\n3. Pass job ID via attribute`);
    }

    // Logout function
    async function logout() {
      if (window.BBComponents?.authManager) {
        await window.BBComponents.authManager.signOut();
      }
    }

    // Notification system (similar to Webflow interactions)
    function showNotification(message, type = 'success') {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 24px;
        right: 24px;
        padding: 16px 24px;
        border-radius: 8px;
        color: white;
        font-weight: 500;
        z-index: 1000;
        animation: slideIn 0.3s ease;
        background: ${type === 'error' ? '#ef4444' : '#22c55e'};
      `;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    // Add keyframe animations
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `;
    document.head.appendChild(style);
    
    // Debug: Log component loading for Webflow developers
    console.log('üêù Blue Banded Bee Webflow Integration Ready');
    console.log('üìä Dashboard Component:', dashboardComponent ? 'Found' : 'Not Found');
    console.log('üîê Auth Component:', authComponent ? 'Found' : 'Not Found');
    console.log('‚öôÔ∏è  BBComponents Global:', window.BBComponents ? 'Available' : 'Not Available');
  </script>
</body>
</html>