!function(){"use strict";const t="localhost"===window.location.hostname?"http://localhost:8080":"https://blue-banded-bee.fly.dev";const e=new class{constructor(){this.baseUrl=t,this.token=null}setToken(t){this.token=t}async request(t,e={}){const n=`${this.baseUrl}${t}`,s={"Content-Type":"application/json",...e.headers};this.token&&(s.Authorization=`Bearer ${this.token}`);const a={...e,headers:s};try{const t=await fetch(n,a),e=await t.json();if(!t.ok)throw new Error(e.error?.message||`HTTP ${t.status}`);return e}catch(t){throw console.error("API request failed:",t),t}}async get(t){return this.request(t,{method:"GET"})}async post(t,e){return this.request(t,{method:"POST",body:JSON.stringify(e)})}async put(t,e){return this.request(t,{method:"PUT",body:JSON.stringify(e)})}async delete(t){return this.request(t,{method:"DELETE"})}async getJobs(t={}){const e=new URLSearchParams(t).toString(),n=e?`/v1/jobs?${e}`:"/v1/jobs";return this.get(n)}async getJob(t){return this.get(`/v1/jobs/${t}`)}async createJob(t){return this.post("/v1/jobs",t)}async getJobTasks(t,e={}){const n=new URLSearchParams(e).toString(),s=n?`/v1/jobs/${t}/tasks?${n}`:`/v1/jobs/${t}/tasks`;return this.get(s)}async getUserProfile(){return this.get("/v1/auth/profile")}};var n=Object.freeze({__proto__:null,api:e});class s extends HTMLElement{constructor(){super(),this._isComponentConnected=!1,this.loadingStates=new Map,this.errorStates=new Map}connectedCallback(){this._isComponentConnected=!0,this.render(),this.setupEventListeners()}disconnectedCallback(){this._isComponentConnected=!1,this.cleanup()}attributeChangedCallback(t,e,n){e!==n&&this._isComponentConnected&&this.handleAttributeChange(t,e,n)}render(){}setupEventListeners(){}cleanup(){}handleAttributeChange(t,e,n){}getAttribute(t,e=null){return super.getAttribute(t)||e}getBooleanAttribute(t){return this.hasAttribute(t)&&"false"!==this.getAttribute(t)}getNumberAttribute(t,e=0){const n=this.getAttribute(t);return n?parseInt(n,10):e}setLoading(t,e){this.loadingStates.set(t,e),this.updateLoadingState()}isLoading(t=null){return t?this.loadingStates.get(t)||!1:Array.from(this.loadingStates.values()).some((t=>t))}updateLoadingState(){const t=this.isLoading();this.classList.toggle("bb-loading",t);this.querySelectorAll(".bb-loading-indicator").forEach((e=>{e.style.display=t?"block":"none"}))}setError(t,e){e?this.errorStates.set(t,e):this.errorStates.delete(t),this.updateErrorState()}hasError(t=null){return t?this.errorStates.has(t):this.errorStates.size>0}updateErrorState(){const t=this.hasError();this.classList.toggle("bb-error",t);const e=this.querySelectorAll(".bb-error-message");if(t){const t=Array.from(this.errorStates.values())[0];e.forEach((e=>{e.textContent=t.message||t.toString(),e.style.display="block"}))}else e.forEach((t=>{t.style.display="none"}))}populateTemplate(t,e,n=null){const s=this.querySelector(t),a=n?this.querySelector(n):this;if(!s)return console.warn(`Template not found: ${t}`),null;const i=s.cloneNode(!0);return i.classList.remove("template"),i.style.display="",this.bindDataToElement(i,e),a&&a!==this&&a.appendChild(i),i}bindDataToElement(t,e){t.querySelectorAll("[data-bind]").forEach((t=>{const n=t.dataset.bind,s=this.getNestedValue(e,n);void 0!==s&&("INPUT"===t.tagName||"TEXTAREA"===t.tagName?t.value=s:t.textContent=s)}));t.querySelectorAll("[data-style-bind]").forEach((t=>{t.dataset.styleBind.split(",").forEach((n=>{const[s,a]=n.split(":"),i=this.getNestedValue(e,a.trim());void 0!==i&&(t.style[s.trim()]=i)}))}))}getNestedValue(t,e){return e.split(".").reduce(((t,e)=>t?.[e]),t)}dispatchCustomEvent(t,e={}){const n=new CustomEvent(`bb:${t}`,{detail:e,bubbles:!0,cancelable:!0});this.dispatchEvent(n)}getLoadingHTML(){return'<div class="bb-loading-indicator" style="display: none;">Loading...</div>'}getErrorHTML(){return'<div class="bb-error-message" style="display: none;"></div>'}}const a=new class{constructor(){this.user=null,this.session=null,this.listeners=new Set,this.supabase=null,this.init()}async init(){await this.waitForSupabase();const{data:{session:t}}=await this.supabase.auth.getSession();this.setSession(t),this.supabase.auth.onAuthStateChange(((t,e)=>{this.setSession(e),this.notifyListeners(t,e)}))}async waitForSupabase(){if(!window.supabase)return new Promise((t=>{const e=()=>{window.supabase?(this.supabase=window.supabase,t()):setTimeout(e,100)};e()}));this.supabase=window.supabase}setSession(t){this.session=t,this.user=t?.user||null,t?.access_token?e.setToken(t.access_token):e.setToken(null)}async signIn(t,e){this.supabase||await this.waitForSupabase();const{data:n,error:s}=await this.supabase.auth.signInWithPassword({email:t,password:e});if(s)throw s;return n}async signUp(t,e,n={}){this.supabase||await this.waitForSupabase();const{data:s,error:a}=await this.supabase.auth.signUp({email:t,password:e,options:{data:n}});if(a)throw a;return s}async signInWithProvider(t){this.supabase||await this.waitForSupabase();const{data:e,error:n}=await this.supabase.auth.signInWithOAuth({provider:t,options:{redirectTo:window.location.origin+"/dashboard"}});if(n)throw n;return e}async signOut(){this.supabase||await this.waitForSupabase();const{error:t}=await this.supabase.auth.signOut();if(t)throw t}async resetPassword(t){this.supabase||await this.waitForSupabase();const{data:e,error:n}=await this.supabase.auth.resetPasswordForEmail(t,{redirectTo:window.location.origin+"/reset-password"});if(n)throw n;return e}isAuthenticated(){return!!this.session}getUser(){return this.user}getSession(){return this.session}getToken(){return this.session?.access_token||null}onAuthStateChange(t){return this.listeners.add(t),()=>{this.listeners.delete(t)}}notifyListeners(t,e){this.listeners.forEach((n=>{try{n(t,e)}catch(t){console.error("Auth listener error:",t)}}))}async getUserProfile(){if(!this.isAuthenticated())throw new Error("User not authenticated");try{return await e.getUserProfile()}catch(t){throw console.error("Failed to get user profile:",t),t}}async updateProfile(t){this.supabase||await this.waitForSupabase();const{data:e,error:n}=await this.supabase.auth.updateUser(t);if(n)throw n;return e}};function i(t){return!!a.isAuthenticated()||(t.innerHTML='\n      <div class="bb-auth-required">\n        <p>Please log in to access this feature.</p>\n        <bb-auth-login></bb-auth-login>\n      </div>\n    ',!1)}var r=Object.freeze({__proto__:null,authManager:a,requireAuth:i});customElements.define("bb-data-loader",class extends s{static get observedAttributes(){return["endpoint","template","target","auto-load","require-auth","refresh-interval"]}constructor(){super(),this.refreshTimer=null,this.data=null}connectedCallback(){super.connectedCallback(),this.getBooleanAttribute("require-auth")&&!i(this)||(this.getBooleanAttribute("auto-load")&&this.loadData(),this.setupRefreshTimer())}disconnectedCallback(){super.disconnectedCallback(),this.clearRefreshTimer()}handleAttributeChange(t,e,n){switch(t){case"endpoint":this.getBooleanAttribute("auto-load")&&this.loadData();break;case"refresh-interval":this.setupRefreshTimer()}}render(){this.innerHTML.trim()||(this.innerHTML=`\n        ${this.getLoadingHTML()}\n        ${this.getErrorHTML()}\n      `)}async loadData(){const t=this.getAttribute("endpoint");if(t){this.setLoading("data",!0),this.setError("endpoint",null);try{const n=await e.get(t);this.data=n.data,this.populateTemplates(),this.dispatchCustomEvent("data-loaded",{data:this.data,endpoint:t})}catch(e){this.setError("endpoint",e),this.dispatchCustomEvent("data-error",{error:e,endpoint:t})}finally{this.setLoading("data",!1)}}else this.setError("endpoint",new Error("No endpoint specified"))}populateTemplates(){const t=this.getAttribute("template"),e=this.getAttribute("target");if(t&&this.data){if(e){const t=document.querySelector(e);if(t){t.querySelectorAll(":not(.template)").forEach((t=>t.remove()))}}Array.isArray(this.data)?this.data.forEach((n=>{this.populateTemplate(t,n,e)})):"object"==typeof this.data&&this.populateTemplate(t,this.data,e)}}populateTemplate(t,e,n=null){const s=super.populateTemplate(t,e,n);if(s){s.querySelectorAll("[data-link]").forEach((t=>{t.addEventListener("click",(n=>{n.preventDefault();const s=t.dataset.link;this.handleLinkClick(s,e,t)}))}));s.querySelectorAll("[data-form]").forEach((t=>{t.addEventListener("submit",(n=>{n.preventDefault();const s=t.dataset.form;this.handleFormSubmit(s,e,t)}))}))}return s}handleLinkClick(t,e,n){switch(t){case"job-details":window.location.href=`/jobs?id=${e.id}`;break;case"cancel-job":this.cancelJob(e.id);break;default:this.dispatchCustomEvent("link-click",{linkType:t,data:e,element:n})}}handleFormSubmit(t,e,n){this.dispatchCustomEvent("form-submit",{formType:t,data:e,form:n})}async cancelJob(t){try{this.setLoading("cancel",!0),await e.post(`/v1/jobs/${t}/cancel`),this.loadData(),this.dispatchCustomEvent("job-cancelled",{jobId:t})}catch(t){this.setError("cancel",t)}finally{this.setLoading("cancel",!1)}}setupRefreshTimer(){this.clearRefreshTimer();const t=this.getNumberAttribute("refresh-interval");t>0&&(this.refreshTimer=setInterval((()=>{this._isComponentConnected&&!this.isLoading()&&this.loadData()}),1e3*t))}clearRefreshTimer(){this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=null)}refresh(){this.loadData()}getData(){return this.data}});function o(){if(console.log("Blue Banded Bee Web Components loaded successfully"),!document.querySelector("#bb-components-styles")){const t=document.createElement("style");t.id="bb-components-styles",t.textContent="\n    /* Blue Banded Bee Component Styles */\n    .bb-loading {\n      opacity: 0.7;\n      pointer-events: none;\n    }\n    \n    .bb-loading-indicator {\n      padding: 20px;\n      text-align: center;\n      color: #666;\n    }\n    \n    .bb-error {\n      border: 1px solid #ff6b6b;\n      border-radius: 4px;\n      background: #fff5f5;\n    }\n    \n    .bb-error-message {\n      padding: 10px;\n      color: #d63031;\n      background: #fff5f5;\n      border-radius: 4px;\n      margin: 10px 0;\n    }\n    \n    .bb-btn {\n      display: inline-block;\n      padding: 12px 24px;\n      border: none;\n      border-radius: 6px;\n      font-size: 14px;\n      font-weight: 500;\n      text-decoration: none;\n      cursor: pointer;\n      transition: all 0.2s ease;\n    }\n    \n    .bb-btn-primary {\n      background: #0066ff;\n      color: white;\n    }\n    \n    .bb-btn-primary:hover {\n      background: #0052cc;\n    }\n    \n    .bb-btn-social {\n      background: white;\n      border: 1px solid #ddd;\n      color: #333;\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      width: 100%;\n      justify-content: center;\n      margin: 5px 0;\n    }\n    \n    .bb-btn-social:hover {\n      background: #f8f9fa;\n    }\n    \n    .bb-social-icon {\n      font-weight: bold;\n      font-size: 16px;\n    }\n    \n    .bb-auth-login .form-group {\n      margin-bottom: 16px;\n    }\n    \n    .bb-auth-login label {\n      display: block;\n      margin-bottom: 4px;\n      font-weight: 500;\n    }\n    \n    .bb-auth-login input {\n      width: 100%;\n      padding: 12px;\n      border: 1px solid #ddd;\n      border-radius: 6px;\n      font-size: 14px;\n    }\n    \n    .bb-auth-login input:focus {\n      outline: none;\n      border-color: #0066ff;\n      box-shadow: 0 0 0 3px rgba(0, 102, 255, 0.1);\n    }\n    \n    .bb-auth-links {\n      margin-top: 16px;\n      text-align: center;\n    }\n    \n    .bb-auth-links a {\n      color: #0066ff;\n      text-decoration: none;\n      font-size: 14px;\n      margin: 0 8px;\n    }\n    \n    .bb-divider {\n      margin: 20px 0;\n      text-align: center;\n      position: relative;\n      color: #666;\n      font-size: 14px;\n    }\n    \n    .bb-divider::before {\n      content: '';\n      position: absolute;\n      top: 50%;\n      left: 0;\n      right: 0;\n      height: 1px;\n      background: #ddd;\n      z-index: 1;\n    }\n    \n    .bb-divider span {\n      background: white;\n      padding: 0 16px;\n      position: relative;\n      z-index: 2;\n    }\n    \n    .template {\n      display: none !important;\n    }\n  ",document.head.appendChild(t)}}customElements.define("bb-auth-login",class extends s{static get observedAttributes(){return["redirect-url","show-providers","compact"]}constructor(){super(),this.unsubscribeAuth=null}connectedCallback(){super.connectedCallback(),this.unsubscribeAuth=a.onAuthStateChange(((t,e)=>{e&&this.hasAttribute("redirect-url")&&this.handleSuccessfulLogin()})),a.isAuthenticated()&&this.hasAttribute("redirect-url")&&this.handleSuccessfulLogin()}disconnectedCallback(){super.disconnectedCallback(),this.unsubscribeAuth&&this.unsubscribeAuth()}render(){const t=this.getBooleanAttribute("compact"),e=this.getBooleanAttribute("show-providers");this.innerHTML=`\n      <div class="bb-auth-login ${t?"compact":""}">\n        ${this.getErrorHTML()}\n        ${this.getLoadingHTML()}\n        \n        <form class="bb-login-form" data-form="login">\n          <div class="form-group">\n            <label for="bb-email">Email</label>\n            <input \n              type="email" \n              id="bb-email" \n              name="email" \n              required\n              placeholder="Enter your email"\n            >\n          </div>\n          \n          <div class="form-group">\n            <label for="bb-password">Password</label>\n            <input \n              type="password" \n              id="bb-password" \n              name="password" \n              required\n              placeholder="Enter your password"\n            >\n          </div>\n          \n          <button type="submit" class="bb-btn bb-btn-primary">\n            Sign In\n          </button>\n          \n          <div class="bb-auth-links">\n            <a href="#" data-action="forgot-password">Forgot password?</a>\n            <a href="#" data-action="show-signup">Need an account? Sign up</a>\n          </div>\n        </form>\n        \n        ${e?this.renderSocialProviders():""}\n      </div>\n    `}renderSocialProviders(){return'\n      <div class="bb-social-login">\n        <div class="bb-divider">\n          <span>or continue with</span>\n        </div>\n        \n        <div class="bb-social-buttons">\n          <button type="button" class="bb-btn bb-btn-social" data-provider="google">\n            <span class="bb-social-icon">G</span>\n            Google\n          </button>\n          \n          <button type="button" class="bb-btn bb-btn-social" data-provider="github">\n            <span class="bb-social-icon">GH</span>\n            GitHub\n          </button>\n          \n          <button type="button" class="bb-btn bb-btn-social" data-provider="slack">\n            <span class="bb-social-icon">S</span>\n            Slack\n          </button>\n        </div>\n      </div>\n    '}setupEventListeners(){const t=this.querySelector(".bb-login-form");t&&t.addEventListener("submit",(t=>this.handleLogin(t)));this.querySelectorAll("[data-provider]").forEach((t=>{t.addEventListener("click",(t=>{const e=t.currentTarget.dataset.provider;this.handleSocialLogin(e)}))}));this.querySelectorAll("[data-action]").forEach((t=>{t.addEventListener("click",(t=>{t.preventDefault();const e=t.currentTarget.dataset.action;this.handleAction(e)}))}))}async handleLogin(t){t.preventDefault();const e=new FormData(t.target),n=e.get("email"),s=e.get("password");this.setLoading("login",!0),this.setError("login",null);try{await a.signIn(n,s)}catch(t){this.setError("login",t)}finally{this.setLoading("login",!1)}}async handleSocialLogin(t){this.setLoading("social",!0),this.setError("social",null);try{await a.signInWithProvider(t)}catch(t){this.setError("social",t),this.setLoading("social",!1)}}handleAction(t){switch(t){case"forgot-password":this.showForgotPassword();break;case"show-signup":this.dispatchCustomEvent("show-signup")}}showForgotPassword(){const t=this.querySelector("#bb-email").value;t?this.sendPasswordReset(t):alert("Please enter your email address first.")}async sendPasswordReset(t){this.setLoading("reset",!0);try{await a.resetPassword(t),alert("Password reset email sent! Check your inbox.")}catch(t){this.setError("reset",t)}finally{this.setLoading("reset",!1)}}handleSuccessfulLogin(){const t=this.getAttribute("redirect-url");this.dispatchCustomEvent("login-success",{user:a.getUser(),redirectUrl:t}),t&&""!==t&&t!==window.location.pathname&&setTimeout((()=>{window.location.href=t}),100)}}),window.BBComponents={version:"1.0.0",components:{"bb-data-loader":"BBDataLoader","bb-auth-login":"BBAuthLogin"},async loadData(t){const{api:e}=await Promise.resolve().then((function(){return n}));return e.get(t)},getAuthManager:()=>Promise.resolve().then((function(){return r})).then((t=>t.authManager))},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",o):o()}();
